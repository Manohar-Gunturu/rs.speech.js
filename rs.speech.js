var speechRs=speechRs||{};speechRs.speechinit=function(e,s,t,n,i,r){this.speaker=new SpeechSynthesisUtterance,this.speaker.pitch=i||1,this.speaker.rate=r||1,this.lan=e;var c=document.createElement("style");c.type="text/css",c.innerHTML=".rsClass{background-color:"+(t||"#4f91e6")+";color:"+(n||"#fff")+";}",document.getElementsByTagName("head")[0].appendChild(c),setTimeout(function(){speechRs.speaker.voice=speechSynthesis.getVoices().filter(function(e){return e.name==speechRs.lan})[0]},500),"native"==e?s(this):setTimeout(function(){s(speechRs)},1e3)},speechRs.speak=function(e,s,t){let n,i=0,r=[];speechRs.speaker.voice=speechSynthesis.getVoices().filter(function(e){return e.name==speechRs.lan})[0],this.speaker.onend=function(e){s(e)},"string"==typeof e?(this.speaker.text=e,speechSynthesis.speak(this.speaker)):t?(i=0,n=e,function e(s){speechRs.speaker.text=s;if(i>=r.length&&s.trim().length<=0)return;n.innerHTML=n.innerHTML.replace(r[i],"<span class='rsClass'>"+r[i]+"</span>");speechSynthesis.speak(speechRs.speaker);speechRs.speaker.onend=function(s){i<r.length&&(speechRs.unwrap(document.querySelector(".rsClass")),e(r[++i]))}}((r=e.innerHTML.split("."))[i])):(this.speaker.text=e.innerHTML,speechSynthesis.speak(this.speaker))},speechRs.rec_start=function(e,s){this.recognition=new webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.arry_com={},this.final_transcript="",this.recognition.lang=e,this.recognition.start(),this.ignore_onend=!1,this.recognition.onstart=function(e){};let t="";this.recognition.onresult=function(e){let n="";if(void 0===e.results)return speechRs.recognition.onend=null,void speechRs.recognition.stop();for(var i=e.resultIndex;i<e.results.length;++i)e.results[i].isFinal?(t="",speechRs.final_transcript+=e.results[i][0].transcript):n+=e.results[i][0].transcript;t!=n&&speechRs.arry_com[n.toLowerCase().trim()]&&(t=n,speechRs.arry_com[n.toLowerCase().trim()]()),s(speechRs.final_transcript.replace("undefined",""),n)}},speechRs.unwrap=function(e){e.parentNode.insertBefore(e.childNodes[0],e),e.parentNode.removeChild(e)},speechRs.on=function(e,s){this.arry_com[e.toLowerCase()]=s},speechRs.rec_stop=function(e){this.recognition.stop(),this.recognition.onstop=function(){return e()}};
